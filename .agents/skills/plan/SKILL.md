---
name: plan
description: 用户明确需要一个新的系统、模块或功能体系或是修改
---

## 0) 前置依赖（强制）
- 1. 此spec所依赖的其他spec
  - docs/global/vision.md
  - docs/global/architecture.md
  - docs/global/naming-rule.md

- 2. 依赖检查流程（强制）
  - 你必须先尝试读取并理解所有依赖文件内容
  - 若任何依赖文件无法读取/不存在/内容为空则
    - **必须只输出以下内容（禁止其他内容**
    > 缺少依赖[<依赖名称>]\n回复「Y」开始创建依赖
    - 下一run使用 skill: spec-creator
  - 若所有依赖都存在则继续执行

---

## 1) 生成目标（不可变，不询问用户）

- 1. 生成一份 Plan 文件
  - 文件路径：`./docs/plan/<index>-<plan目标>.md`
    - `<index>`：根据 `./docs/plan/` 目录下已有文件数量顺序递增生成
    - `<plan目标>`：在完成需求澄清后，根据本次变更的核心意图自动总结生成
  - 输出格式：Markdown
  - 语言：中文为主

---

## 2) 需求澄清问题集合
- 接下来您将询问来帮助用户理清他想要新增或修改什么

- 1. 问题集（强制）
  - 以下问题必须按顺序逐一询问
  - 每一题在获得明确回答前，不得进入下一题

  - 1.问题1
    > 你现在想新增 / 修改 / 调整一个什么功能？
    > (做完之后，你希望哪里和现在不一样？）
  - 1.问题2
    > 这个功能通常是在什么情景下被需要的？
    > (是谁、在什么情况下，会想用到它？）
  - 1.问题3
    > 和现在相比，这个功能会让哪些行为或结果不一样？
    > (例如：流程变化、结果不同、原本不能做的现在可以了）
  - 1.问题4
    > 你觉得这个功能有没有哪些地方特别容易出错？
    > (例如：不稳定、依赖他人、依赖外部api、流程复杂）
  - 1.问题5
    > 如果这次改动真的出问题，你觉得最严重的后果会是什么？
    > (哪种情况是你最不能接受的？）

- 2. 每个问题的描述规范
  - 1.描述问题
    > 你想要新增修改什么功能?
  - 2.尝试结合所有的前置依赖spec里的资讯,以及用户之前的回答,给与本次问题的建议回答
    > 猜你可能想要新增登入功能?
    - 建议回答仅用于帮助用户更快确认其真实意图
    - 不得引导用户做出架构或实现层面的决策
  - 3.提供建议回答后,和用户说
    > 回答'Y'接受,或直接描述您的答案

- 3. 问题描述范例
  > 你想要新增修改什么功能?
  > 猜你可能想要新增登入功能?
  > 回答'Y'接受,或直接描述您的答案

- 4. 禁止事项（非常重要）
  - ❌ 本阶段不允许做理解需求以外的事情
  - ❌ 不得在此阶段讨论 模块类型（Service / Adapter / Core 等）
  - ❌ 不得在此阶段讨论 架构设计
  - ❌ 不得在此阶段讨论 技术选型或实现方式

## 3) plan.md内容思考流程（强制）
- 目标：基于需求澄清结果，生成一份可执行的 plan.md
- 不直接新增或修改任何 Modules Spec

- 0. 现况盘点
  - 必须扫描并列出当前已存在的 Modules Spec 文件路径清单：
    - `./docs/spec/<Module类型>/<Module名称>.md`
  - 若不存在任何 Modules Spec：
    - 必须明确写出「当前无既有 Modules Spec」
    - 后续所有 Modules 只能列在「新增 Modules」

- 1. 这一步推断会用的参考资料
  - 1.需求澄清阶段的最终回答
  - 2.前置依赖spec（vision / architecture / naming-rule）
  - 3.既有Modules Spec (docs/*/*.md)

- 2. 这一步我们关注的点
  - 本次变更涉及哪些 Modules（新增 / 修改 / 不涉及）
  - 每个 Module 需要做什么层级的调整（高层描述）
  - 是否需要新增 Module（记得目前不创建文件）

- 3. 这一步我们的思考流程
  - 1.理清系统边界
  - 2.理清流程 / 状态
  - 3.整理成可执行步骤

- 4. 这一步若遇到信息不足无法判断
  - 直接询问用户你需要的信息,再重新执行这一步(plan.md)
  - ❌ 在获得补充信息 / 用户选择前不得生成不完整或假设性的 plan.md

- 5. 这一步若遇到存在多种可行方案
  - 直接询问用户选择哪种方案,再重新执行这一步(plan.md)
  - ❌ 在获得补充信息 / 用户选择前不得生成不完整或假设性的 plan.md

- 6. plan.md的定位声明
  - plan.md 是执行计划，不是规格
  - plan.md 不等同于 Modules Spec
  - 执行 plan.md 才会修改 spec  

---

## 4) plan.md内容模板
- 档案名称: <index>-<plan目标>.md

<以下为plan.md内容模板>
## 0) 本次 Plan 的定位说明（不可修改）
- 本文件为一次**可执行的变更计划**
- 本文件不等同于任何 Modules Spec
- 仅在执行本 Plan 时，才会新增或修改 Modules Spec

---

## 1) 本次变更的背景与目标

> 用**人话**描述为什么要做这次变更，以及希望达成什么状态
> 内容应来自需求澄清阶段的总结，不引入新假设

* 背景说明：
* 目标状态（After）：
* 当前状态（Before，可选）：

---

## 2) 需求澄清结论摘要（只读）

> 本节用于**固化需求理解结果**，不再修改、不再讨论

* 核心需求一句话总结：
* 关键使用情境：
* 行为 / 结果上的变化点：
* 主要风险认知：
* 最不可接受的失败结果：

---

## 3) 本次变更涉及的 Modules 范围

> 本节是 **Plan 的核心决策结果之一**
> Modules若无对应Spec文件，则不得写入 3.2，必须写入 3.1（新增 Modules）

### 3.1 新增 Modules（若无请写：无）

* Module 类型：
* Module 名称：
* 新增原因简述：

---

### 3.2 需要修改的既有 Modules（若无请写：无）

* Module 类型：
* Module 名称：
* Module Spec路径：

* 修改原因简述：
* 预计影响范围（高层）：    

---

### 3.3 明确不涉及的 Modules（可选）

* Module 名称或范围：
* 不涉及原因（可选）：

---

## 4) 各 Module 的调整指令（高层）

> 注意：**不是 spec 内容，只是“该改什么方向”**

按 Module 拆分，每个 Module 一小节：

```md
### <Module类型>: <Module名称>
- 本次调整目的：
- 需要改变的行为或责任边界：
- 不应改变的部分（若有）：
```

---

## 5) 执行顺序与依赖说明

> 明确执行本 Plan 时的推荐顺序
> 解决「先改哪个、后改哪个」的问题

* Step 1：
* Step 2：
* Step 3：

---

## 6) 风险点与验证关注事项

> 用于在执行 spec 时作为 **检查清单**

* 高风险 Module：
* 可能失败的情境：
* 执行后需要特别确认的行为或结果：

---

## 7) 未决事项 / 待确认问题（如有）

> 若在生成 Plan 时存在无法确定的点，必须记录在此

* 问题描述：
* 需要谁确认：
* 确认后将影响的决策：

---

## 8) 非目标（Non-goals）

> 明确写出：**这次 Plan 不打算解决什么**

* 本次不包含的功能：
* 明确不处理的场景：

---

## 9) Plan 执行完成后的期望状态

> 用于在执行完所有 Modules Spec 修改后对照验证

* 功能层面的完成标准：
* 行为层面的完成标准：
* 哪些变化是“必须发生的”：

<以上为plan.md内容模板>